!function(){let e=Object.prototype.hasOwnProperty,n=function(n){for(let t=1;t<arguments.length;t++){let o=arguments[t];for(let t in o)e.call(o,t)&&(n[t]=o[t])}return n},t=function(e){let n=document.getElementById(e).getAttribute("content");return n==="["+e+"]"?null:n},o=window.Byond={};o.windowId=t("tgui:windowId"),window.__windowId__=o.windowId,o.TRIDENT=function(){let e=navigator.userAgent.match(/Trident\/(\d+).+?;/i),n=e&&e[1];return n?parseInt(n,10):null}(),o.BLINK=function(){let e=navigator.userAgent.match(/Chrome\/(\d+)\./),n=e&&e[1];return n?parseInt(n,10):null}();let r=(null!==o.TRIDENT||null!==o.BLINK||window.cef_to_byond)&&"127.0.0.1"===location.hostname&&"?external"!==location.search;o.IS_BYOND=r,o.strictMode=Boolean(Number(t("tgui:strictMode"))),o.__callbacks__=[];let i=function(e,n){return"object"==typeof n&&null!==n&&n.__number__?parseFloat(n.__number__):n};o.call=function(n,t){if(!r)return;let o=(n||"")+"?",i=0;if(t)for(let n in t)if(e.call(t,n)){i++>0&&(o+="&");let e=t[n];null==e&&(e=""),o+=encodeURIComponent(n)+"="+encodeURIComponent(e)}if(window.cef_to_byond)return void cef_to_byond("byond://"+o);if(o.length<2048)return void(location.href="byond://"+o);let l=new XMLHttpRequest;l.open("GET",o),l.send()},o.callAsync=function(e,t){if(!window.Promise)throw new Error("Async calls require API level of ES2015 or later.");let r=o.__callbacks__.length,i=new window.Promise((e=>{o.__callbacks__.push(e)}));return o.call(e,n({},t,{callback:"Byond.__callbacks__["+r+"]"})),i},o.topic=function(e){return o.call("",e)},o.command=function(e){return o.call("winset",{command:e})},o.winget=function(e,n){null===e&&(e="");let t=n instanceof Array,r=n&&"*"!==n&&!t,i=o.callAsync("winget",{id:e,property:t&&n.join(",")||n||"*"});return r&&(i=i.then((e=>e[n]))),i},o.winset=function(e,t,r){if(null===e)e="";else if("object"==typeof e)return o.call("winset",e);let i={};return"string"==typeof t?i[t]=r:n(i,t),i.id=e,o.call("winset",i)},o.parseJson=function(e){try{return JSON.parse(e,i)}catch(e){throw new Error("JSON parsing error: "+(e&&e.message))}};let l=1024;o.sendMessage=function(e,t){let r="string"==typeof e?{type:e,payload:t}:e;if(null!==r.payload&&void 0!==r.payload&&(r.payload=JSON.stringify(r.payload),!o.TRIDENT&&r.payload.length>l)){let n=[];for(let e=0,t=r.payload.length;e<t;e+=l)n.push(r.payload.substring(e,e+l));for(let t=0;t<n.length;t++){r={type:e,packet:n[t],packetId:t+1,totalPackets:n.length,tgui:1,window_id:o.windowId},o.topic(r)}}else n(r,{tgui:1,window_id:o.windowId}),o.topic(r)},o.injectMessage=function(e,n){window.update(JSON.stringify({type:e,payload:n}))},o.subscribe=function(e){window.update.flushQueue(e),window.update.listeners.push(e)},o.subscribeTo=function(e,n){let t=function(t,o){t===e&&n(o)};window.update.flushQueue(t),window.update.listeners.push(t)};let a={},d=function(e){if(!document.body)return void setTimeout((()=>{d(e)}));let n=document.body.childNodes,t=n[n.length-1];t.parentNode.insertBefore(e,t.nextSibling)},s=function(e){let n=e.url,t=e.type,o=e.sync,r=e.attempt||0;if(a[n])return;a[n]=e;let i=function(){if(r>=5){let e="Error: Failed to load the asset '"+n+"' after several attempts.";throw"css"===t&&(e+="NaNor you're trying to load an empty stylesheet that has no CSS rules in it."),new Error(e)}setTimeout((()=>{a[n]=null,e.attempt+=1,s(e)}),500+500*r)};if("js"===t){let e=document.createElement("script");return e.type="text/javascript",e.crossOrigin="anonymous",e.src=n,o?e.defer=!0:e.async=!0,e.onerror=function(){e.onerror=null,e.parentNode.removeChild(e),e=null,i()},void d(e)}if("css"===t){let e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.crossOrigin="anonymous",e.href=n,o||(e.media="only x");let t=function(){e.parentNode.removeChild(e),e=null,i()};return e.onerror=function(){e.onerror=null,t()},e.onload=function(){e.onload=null,function(e,n){let t=e.sheet;return!!t&&t.rules.length>0}(e)?e.media="all":t()},void d(e)}};o.loadJs=function(e,n){s({url:e,sync:n,type:"js"})},o.loadCss=function(e,n){s({url:e,sync:n,type:"css"})},o.saveBlob=function(e,n,t){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,n);else if(window.showSaveFilePicker){let o={};o[e.type]=[t];let r={suggestedName:n,types:[{description:"SS13 file",accept:o}]};try{window.showSaveFilePicker(r).then((n=>{n.createWritable().then((n=>{n.write(e).then((()=>{n.close()})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))}catch(e){console.error(e)}}},o.iconRefMap={}}(),window.onerror=function(e,n,t,o,r){window.onerror.errorCount=(window.onerror.errorCount||0)+1;let i=r&&r.stack;if(i||(i=e+"\n   at "+n+":"+t,o&&(i+=":"+o)),i=window.__augmentStack__(i,r),Byond.strictMode){let e=document.getElementById("FatalError"),n=document.getElementById("FatalError__stack");if(e){e.className="FatalError FatalError--visible",window.onerror.__stack__?window.onerror.__stack__+="\n\n"+i:window.onerror.__stack__=i,n["textContent"]=window.onerror.__stack__}let t=function(){Byond.winset(Byond.windowId,{titlebar:!0,"is-visible":!0,"can-resize":!0})};t(),setInterval(t,1e3)}return Byond.strictMode?Byond.sendMessage({type:"log",fatal:1,message:i}):window.onerror.errorCount<=1&&(i+="\nWindow is in non-strict mode, future errors are suppressed.",Byond.sendMessage({type:"log",message:i})),Byond.strictMode&&(window.update=function(){},window.update.queue=[]),!0},window.onunhandledrejection=function(e){let n="UnhandledRejection";e.reason&&(n+=": "+(e.reason.message||e.reason.description||e.reason),e.reason.stack&&(e.reason.stack="UnhandledRejection: "+e.reason.stack)),window.onerror(n,null,null,null,e.reason)},window.__augmentStack__=function(e,n){return e+"\nUser Agent: "+navigator.userAgent},window.update=function(e){if(window.update.queueActive)return void window.update.queue.push(e);let n=Byond.parseJson(e),t=window.update.listeners;for(let e=0;e<t.length;e++)t[e](n.type,n.payload)},window.update.listeners=[],window.update.queue=[],window.update.queueActive=!0,window.update.flushQueue=function(e){window.update.queueActive&&(window.update.queueActive=!1,window.setTimeout&&window.setTimeout((()=>{window.update.queue=[]}),0));let n=window.update.queue;for(let t=0;t<n.length;t++){let o=Byond.parseJson(n[t]);e(o.type,o.payload)}},window.replaceHtml=function(e){let n=document.body.childNodes;for(let e=0;e<n.length;e++)if(" tgui:inline-html-start "==n[e].nodeValue){for(;" tgui:inline-html-end "!=n[e].nodeValue;)n[e].remove();n[e].remove()}document.body.insertAdjacentHTML("afterbegin","\x3c!-- tgui:inline-html-start --\x3e"+e+"\x3c!-- tgui:inline-html-end --\x3e")};
