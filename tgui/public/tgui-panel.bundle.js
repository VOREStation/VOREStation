!function(){var e,t={1689:function(e,t){"use strict";t.__esModule=!0,t.Color=void 0;var n=1e-4,r=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=n,this.a=r}return e.prototype.toString=function(){return"rgba("+(0|this.r)+", "+(0|this.g)+", "+(0|this.b)+", "+(0|this.a)+")"},e}();t.Color=r,r.fromHex=function(e){return new r(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16))},r.lerp=function(e,t,n){return new r((t.r-e.r)*n+e.r,(t.g-e.g)*n+e.g,(t.b-e.b)*n+e.b,(t.a-e.a)*n+e.a)},r.lookup=function(e,t){void 0===t&&(t=[]);var o=t.length;if(o<2)throw new Error("Needs at least two colors!");var i=e*(o-1);if(e<n)return t[0];if(e>=.9999)return t[o-1];var a=i%1,c=0|i;return r.lerp(t[c],t[c+1],a)}},98202:function(e,t){"use strict";t.__esModule=!0,t.createUuid=void 0;t.createUuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},59570:function(e,t,n){"use strict";t.__esModule=!0,t.Notifications=void 0;var r=n(9333),o=n(13435),i=function(e){var t=e.children;return(0,r.createVNode)(1,"div","Notifications",t,0)};t.Notifications=i;i.Item=function(e){var t=e.rightSlot,n=e.children;return(0,r.createComponentVNode)(2,o.Flex,{align:"center",className:"Notification",children:[(0,r.createComponentVNode)(2,o.Flex.Item,{className:"Notification__content",grow:1,children:n}),t&&(0,r.createComponentVNode)(2,o.Flex.Item,{className:"Notification__rightSlot",children:t})]})}},49042:function(e,t,n){"use strict";t.__esModule=!0,t.Panel=void 0;var r=n(9333),o=n(13435),i=n(59979),a=n(29537),c=n(50351),s=n(63789),u=n(59570),l=n(97125),d=n(39466);t.Panel=function(e,t){if(Byond.IS_LTE_IE10)return(0,r.createComponentVNode)(2,h);var n=(0,a.useAudio)(t),g=(0,d.useSettings)(t),p=(0,s.useGame)(t);return(0,r.createComponentVNode)(2,i.Pane,{theme:g.theme,children:(0,r.createComponentVNode)(2,o.Stack,{fill:!0,vertical:!0,children:[(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,o.Section,{fitted:!0,children:(0,r.createComponentVNode)(2,o.Stack,{mr:1,align:"center",children:[(0,r.createComponentVNode)(2,o.Stack.Item,{grow:!0,overflowX:"auto",children:(0,r.createComponentVNode)(2,c.ChatTabs)}),(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,l.PingIndicator)}),(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,o.Button,{color:"grey",selected:n.visible,icon:"music",tooltip:"Music player",tooltipPosition:"bottom-start",onClick:function(){return n.toggle()}})}),(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,o.Button,{icon:g.visible?"times":"cog",selected:g.visible,tooltip:g.visible?"Close settings":"Open settings",tooltipPosition:"bottom-start",onClick:function(){return g.toggle()}})})]})})}),n.visible&&(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,o.Section,{children:(0,r.createComponentVNode)(2,a.NowPlayingWidget)})}),g.visible&&(0,r.createComponentVNode)(2,o.Stack.Item,{children:(0,r.createComponentVNode)(2,d.SettingsPanel)}),(0,r.createComponentVNode)(2,o.Stack.Item,{grow:!0,children:(0,r.createComponentVNode)(2,o.Section,{fill:!0,fitted:!0,position:"relative",children:[(0,r.createComponentVNode)(2,i.Pane.Content,{scrollable:!0,children:(0,r.createComponentVNode)(2,c.ChatPanel,{lineHeight:g.lineHeight})}),(0,r.createComponentVNode)(2,u.Notifications,{children:[p.connectionLostAt&&(0,r.createComponentVNode)(2,u.Notifications.Item,{rightSlot:(0,r.createComponentVNode)(2,o.Button,{color:"white",onClick:function(){return Byond.command(".reconnect")},children:"Reconnect"}),children:"You are either AFK, experiencing lag or the connection has closed."}),p.roundRestartedAt&&(0,r.createComponentVNode)(2,u.Notifications.Item,{children:"The connection has been closed because the server is restarting. Please wait while you automatically reconnect."})]})]})})]})})};var h=function(e,t){var n=(0,d.useSettings)(t);return(0,r.createComponentVNode)(2,i.Pane,{theme:n.theme,children:(0,r.createComponentVNode)(2,i.Pane.Content,{scrollable:!0,children:[(0,r.createComponentVNode)(2,o.Button,{style:{position:"fixed",top:"1em",right:"2em","z-index":1e3},selected:n.visible,onClick:function(){return n.toggle()},children:"Settings"}),n.visible&&(0,r.createComponentVNode)(2,d.SettingsPanel)||(0,r.createComponentVNode)(2,c.ChatPanel,{lineHeight:n.lineHeight})]})})}},10804:function(e,t,n){"use strict";t.__esModule=!0,t.NowPlayingWidget=void 0;var r=n(9333),o=n(42991),i=n(42730),a=n(13435),c=n(39466),s=n(9199);t.NowPlayingWidget=function(e,t){var n,u=(0,i.useSelector)(t,s.selectAudio),l=(0,i.useDispatch)(t),d=(0,c.useSettings)(t),h=null==(n=u.meta)?void 0:n.title;return(0,r.createComponentVNode)(2,a.Flex,{align:"center",children:[u.playing&&(0,r.createFragment)([(0,r.createComponentVNode)(2,a.Flex.Item,{shrink:0,mx:.5,color:"label",children:"Now playing:"}),(0,r.createComponentVNode)(2,a.Flex.Item,{mx:.5,grow:1,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},children:h||"Unknown Track"})],4)||(0,r.createComponentVNode)(2,a.Flex.Item,{grow:1,color:"label",children:"Nothing to play."}),u.playing&&(0,r.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,r.createComponentVNode)(2,a.Button,{tooltip:"Stop",icon:"stop",onClick:function(){return l({type:"audio/stopMusic"})}})}),(0,r.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,r.createComponentVNode)(2,a.Knob,{minValue:0,maxValue:1,value:d.adminMusicVolume,step:.0025,stepPixelSize:1,format:function(e){return(0,o.toFixed)(100*e)+"%"},onDrag:function(e,t){return d.update({adminMusicVolume:t})}})})]})}},40882:function(e,t,n){"use strict";t.__esModule=!0,t.useAudio=void 0;var r=n(42730),o=n(9199);t.useAudio=function(e){var t=(0,r.useSelector)(e,o.selectAudio),n=(0,r.useDispatch)(e);return Object.assign({},t,{toggle:function(){return n({type:"audio/toggle"})}})}},29537:function(e,t,n){"use strict";t.__esModule=!0,t.useAudio=t.audioReducer=t.audioMiddleware=t.NowPlayingWidget=void 0;var r=n(40882);t.useAudio=r.useAudio;var o=n(12917);t.audioMiddleware=o.audioMiddleware;var i=n(10804);t.NowPlayingWidget=i.NowPlayingWidget;var a=n(6439);t.audioReducer=a.audioReducer},12917:function(e,t,n){"use strict";t.__esModule=!0,t.audioMiddleware=void 0;var r=n(99098),o=["url"];t.audioMiddleware=function(e){var t=new r.AudioPlayer;return t.onPlay((function(){e.dispatch({type:"audio/playing"})})),t.onStop((function(){e.dispatch({type:"audio/stopped"})})),function(e){return function(n){var r=n.type,i=n.payload;if("audio/playMusic"===r){var a=i.url,c=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(i,o);return t.play(a,c),e(n)}if("audio/stopMusic"===r)return t.stop(),e(n);if("settings/update"===r||"settings/load"===r){var s=null==i?void 0:i.adminMusicVolume;return"number"==typeof s&&t.setVolume(s),e(n)}return e(n)}}}},99098:function(e,t,n){"use strict";function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.__esModule=!0,t.AudioPlayer=void 0;var i=(0,n(20641).createLogger)("AudioPlayer"),a=function(){function e(){var e=this;Byond.IS_LTE_IE9||(this.node=document.createElement("audio"),this.node.style.setProperty("display","none"),document.body.appendChild(this.node),this.playing=!1,this.volume=1,this.options={},this.onPlaySubscribers=[],this.onStopSubscribers=[],this.node.addEventListener("canplaythrough",(function(){i.log("canplaythrough"),e.playing=!0,e.node.playbackRate=e.options.pitch||1,e.node.currentTime=e.options.start||0,e.node.volume=e.volume,e.node.play();for(var t,n=r(e.onPlaySubscribers);!(t=n()).done;){(0,t.value)()}})),this.node.addEventListener("ended",(function(){i.log("ended"),e.stop()})),this.node.addEventListener("error",(function(t){e.playing&&(i.log("playback error",t.error),e.stop())})),this.playbackInterval=setInterval((function(){e.playing&&(e.options.end>0&&e.node.currentTime>=e.options.end&&e.stop())}),1e3))}var t=e.prototype;return t.destroy=function(){this.node&&(this.node.stop(),document.removeChild(this.node),clearInterval(this.playbackInterval))},t.play=function(e,t){void 0===t&&(t={}),this.node&&(i.log("playing",e,t),this.options=t,this.node.src=e)},t.stop=function(){if(this.node){if(this.playing)for(var e,t=r(this.onStopSubscribers);!(e=t()).done;)(0,e.value)();i.log("stopping"),this.playing=!1,this.node.src=""}},t.setVolume=function(e){this.node&&(this.volume=e,this.node.volume=e)},t.onPlay=function(e){this.node&&this.onPlaySubscribers.push(e)},t.onStop=function(e){this.node&&this.onStopSubscribers.push(e)},e}();t.AudioPlayer=a},6439:function(e,t){"use strict";t.__esModule=!0,t.audioReducer=void 0;var n={visible:!1,playing:!1,track:null};t.audioReducer=function(e,t){void 0===e&&(e=n);var r=t.type,o=t.payload;return"audio/playing"===r?Object.assign({},e,{visible:!0,playing:!0}):"audio/stopped"===r?Object.assign({},e,{visible:!1,playing:!1}):"audio/playMusic"===r?Object.assign({},e,{meta:o}):"audio/stopMusic"===r?Object.assign({},e,{visible:!1,playing:!1,meta:null}):"audio/toggle"===r?Object.assign({},e,{visible:!e.visible}):e}},9199:function(e,t){"use strict";t.__esModule=!0,t.selectAudio=void 0;t.selectAudio=function(e){return e.audio}},45104:function(e,t,n){"use strict";t.__esModule=!0,t.ChatPageSettings=void 0;var r=n(9333),o=n(42730),i=n(13435),a=n(74275),c=n(48463),s=n(67063);t.ChatPageSettings=function(e,t){var n=(0,o.useSelector)(t,s.selectCurrentChatPage),u=(0,o.useDispatch)(t);return(0,r.createComponentVNode)(2,i.Section,{children:[(0,r.createComponentVNode)(2,i.Stack,{align:"center",children:[(0,r.createComponentVNode)(2,i.Stack.Item,{grow:1,children:(0,r.createComponentVNode)(2,i.Input,{fluid:!0,value:n.name,onChange:function(e,t){return u((0,a.updateChatPage)({pageId:n.id,name:t}))}})}),(0,r.createComponentVNode)(2,i.Stack.Item,{children:(0,r.createComponentVNode)(2,i.Button,{icon:"times",color:"red",onClick:function(){return u((0,a.removeChatPage)({pageId:n.id}))},children:"Remove"})})]}),(0,r.createComponentVNode)(2,i.Divider),(0,r.createComponentVNode)(2,i.Section,{title:"Messages to display",level:2,children:[c.MESSAGE_TYPES.filter((function(e){return!e.important&&!e.admin})).map((function(e){return(0,r.createComponentVNode)(2,i.Button.Checkbox,{checked:n.acceptedTypes[e.type],onClick:function(){return u((0,a.toggleAcceptedType)({pageId:n.id,type:e.type}))},children:e.name},e.type)})),(0,r.createComponentVNode)(2,i.Collapsible,{mt:1,color:"transparent",title:"Admin stuff",children:c.MESSAGE_TYPES.filter((function(e){return!e.important&&e.admin})).map((function(e){return(0,r.createComponentVNode)(2,i.Button.Checkbox,{checked:n.acceptedTypes[e.type],onClick:function(){return u((0,a.toggleAcceptedType)({pageId:n.id,type:e.type}))},children:e.name},e.type)}))})]})]})}},17014:function(e,t,n){"use strict";t.__esModule=!0,t.ChatPanel=void 0;var r=n(9333),o=n(54666),i=n(13435),a=n(82316);function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}var s=function(e){var t,n;function s(){var t;return(t=e.call(this)||this).ref=(0,r.createRef)(),t.state={scrollTracking:!0},t.handleScrollTrackingChange=function(e){return t.setState({scrollTracking:e})},t}n=e,(t=s).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n);var u=s.prototype;return u.componentDidMount=function(){a.chatRenderer.mount(this.ref.current),a.chatRenderer.events.on("scrollTrackingChanged",this.handleScrollTrackingChange),this.componentDidUpdate()},u.componentWillUnmount=function(){a.chatRenderer.events.off("scrollTrackingChanged",this.handleScrollTrackingChange)},u.componentDidUpdate=function(e){requestAnimationFrame((function(){a.chatRenderer.ensureScrollTracking()})),(!e||(0,o.shallowDiffers)(this.props,e))&&a.chatRenderer.assignStyle({width:"100%","white-space":"pre-wrap","font-size":this.props.fontSize,"line-height":this.props.lineHeight})},u.render=function(){var e=this.state.scrollTracking;return(0,r.createFragment)([(0,r.createVNode)(1,"div","Chat",null,1,null,null,this.ref),!e&&(0,r.createComponentVNode)(2,i.Button,{className:"Chat__scrollButton",icon:"arrow-down",onClick:function(){return a.chatRenderer.scrollToBottom()},children:"Scroll to bottom"})],0)},s}(r.Component);t.ChatPanel=s},97724:function(e,t,n){"use strict";t.__esModule=!0,t.ChatTabs=void 0;var r=n(9333),o=n(42730),i=n(13435),a=n(74275),c=n(67063),s=n(99457),u=function(e){var t=e.value;return(0,r.createComponentVNode)(2,i.Box,{style:{"font-size":"0.7em","border-radius":"0.25em",width:"1.7em","line-height":"1.55em","background-color":"crimson",color:"#fff"},children:Math.min(t,99)})};t.ChatTabs=function(e,t){var n=(0,o.useSelector)(t,c.selectChatPages),l=(0,o.useSelector)(t,c.selectCurrentChatPage),d=(0,o.useDispatch)(t);return(0,r.createComponentVNode)(2,i.Flex,{align:"center",children:[(0,r.createComponentVNode)(2,i.Flex.Item,{children:(0,r.createComponentVNode)(2,i.Tabs,{textAlign:"center",children:n.map((function(e){return(0,r.createComponentVNode)(2,i.Tabs.Tab,{selected:e===l,rightSlot:e.unreadCount>0&&(0,r.createComponentVNode)(2,u,{value:e.unreadCount}),onClick:function(){return d((0,a.changeChatPage)({pageId:e.id}))},children:e.name},e.id)}))})}),(0,r.createComponentVNode)(2,i.Flex.Item,{ml:1,children:(0,r.createComponentVNode)(2,i.Button,{color:"transparent",icon:"plus",onClick:function(){d((0,a.addChatPage)()),d((0,s.openChatSettings)())}})})]})}},74275:function(e,t,n){"use strict";t.__esModule=!0,t.updateMessageCount=t.updateChatPage=t.toggleAcceptedType=t.saveChatToDisk=t.removeChatPage=t.rebuildChat=t.loadChat=t.changeScrollTracking=t.changeChatPage=t.addChatPage=void 0;var r=n(42730),o=n(71891),i=(0,r.createAction)("chat/load");t.loadChat=i;var a=(0,r.createAction)("chat/rebuild");t.rebuildChat=a;var c=(0,r.createAction)("chat/updateMessageCount");t.updateMessageCount=c;var s=(0,r.createAction)("chat/addPage",(function(){return{payload:(0,o.createPage)()}}));t.addChatPage=s;var u=(0,r.createAction)("chat/changePage");t.changeChatPage=u;var l=(0,r.createAction)("chat/updatePage");t.updateChatPage=l;var d=(0,r.createAction)("chat/toggleAcceptedType");t.toggleAcceptedType=d;var h=(0,r.createAction)("chat/removePage");t.removeChatPage=h;var g=(0,r.createAction)("chat/changeScrollTracking");t.changeScrollTracking=g;var p=(0,r.createAction)("chat/saveToDisk");t.saveChatToDisk=p},48463:function(e,t){"use strict";t.__esModule=!0,t.MESSAGE_TYPE_WARNING=t.MESSAGE_TYPE_UNKNOWN=t.MESSAGE_TYPE_SYSTEM=t.MESSAGE_TYPE_RADIO=t.MESSAGE_TYPE_OOC=t.MESSAGE_TYPE_MODCHAT=t.MESSAGE_TYPE_LOCALCHAT=t.MESSAGE_TYPE_INTERNAL=t.MESSAGE_TYPE_INFO=t.MESSAGE_TYPE_EVENTCHAT=t.MESSAGE_TYPE_DEBUG=t.MESSAGE_TYPE_DEADCHAT=t.MESSAGE_TYPE_COMBAT=t.MESSAGE_TYPE_ATTACKLOG=t.MESSAGE_TYPE_ADMINPM=t.MESSAGE_TYPE_ADMINLOG=t.MESSAGE_TYPE_ADMINCHAT=t.MESSAGE_TYPES=t.MESSAGE_SAVE_INTERVAL=t.MESSAGE_PRUNE_INTERVAL=t.MAX_VISIBLE_MESSAGES=t.MAX_PERSISTED_MESSAGES=t.IMAGE_RETRY_MESSAGE_AGE=t.IMAGE_RETRY_LIMIT=t.IMAGE_RETRY_DELAY=t.COMBINE_MAX_TIME_WINDOW=t.COMBINE_MAX_MESSAGES=void 0;t.MAX_VISIBLE_MESSAGES=2500;t.MAX_PERSISTED_MESSAGES=1e3;t.MESSAGE_SAVE_INTERVAL=1e4;t.MESSAGE_PRUNE_INTERVAL=6e4;t.COMBINE_MAX_MESSAGES=5;t.COMBINE_MAX_TIME_WINDOW=5e3;t.IMAGE_RETRY_DELAY=250;t.IMAGE_RETRY_LIMIT=10;t.IMAGE_RETRY_MESSAGE_AGE=6e4;var n="unknown";t.MESSAGE_TYPE_UNKNOWN=n;t.MESSAGE_TYPE_INTERNAL="internal";var r="system";t.MESSAGE_TYPE_SYSTEM=r;var o="localchat";t.MESSAGE_TYPE_LOCALCHAT=o;var i="radio";t.MESSAGE_TYPE_RADIO=i;var a="info";t.MESSAGE_TYPE_INFO=a;var c="warning";t.MESSAGE_TYPE_WARNING=c;var s="deadchat";t.MESSAGE_TYPE_DEADCHAT=s;t.MESSAGE_TYPE_OOC="ooc";var u="adminpm";t.MESSAGE_TYPE_ADMINPM=u;var l="combat";t.MESSAGE_TYPE_COMBAT=l;var d="adminchat";t.MESSAGE_TYPE_ADMINCHAT=d;var h="modchat";t.MESSAGE_TYPE_MODCHAT=h;t.MESSAGE_TYPE_EVENTCHAT="eventchat";var g="adminlog";t.MESSAGE_TYPE_ADMINLOG=g;var p="attacklog";t.MESSAGE_TYPE_ATTACKLOG=p;var f="debug";t.MESSAGE_TYPE_DEBUG=f;var m=[{type:r,name:"System Messages",description:"Messages from your client, always enabled",selector:".boldannounce",important:!0},{type:o,name:"Local",description:"In-character local messages (say, emote, etc)",selector:".say, .emote"},{type:i,name:"Radio",description:"All departments of radio messages",selector:".alert, .minorannounce, .syndradio, .centcomradio, .aiprivradio, .comradio, .secradio, .engradio, .medradio, .sciradio, .suppradio, .servradio, .radio, .deptradio, .binarysay, .newscaster, .resonate"},{type:a,name:"Info",description:"Non-urgent messages from the game and items",selector:".notice:not(.pm), .adminnotice, .info, .sinister, .cult, .infoplain, .announce, .hear, .smallnotice, .holoparasite"},{type:c,name:"Warnings",description:"Urgent messages from the game and items",selector:".warning:not(.pm), .critical, .userdanger, .italics, .alertsyndie, .warningplain"},{type:s,name:"Deadchat",description:"All of deadchat",selector:".deadsay, .ghostalert"},{type:"ooc",name:"OOC",description:"The bluewall of global OOC messages",selector:".ooc, .adminooc, .oocplain"},{type:u,name:"Admin PMs",description:"Messages to/from admins (adminhelp)",selector:".pm, .adminhelp"},{type:l,name:"Combat Log",description:"Urist McTraitor has stabbed you with a knife!",selector:".danger"},{type:n,name:"Unsorted",description:"Everything we could not sort, always enabled"},{type:d,name:"Admin Chat",description:"ASAY messages",selector:".admin_channel, .adminsay",admin:!0},{type:h,name:"Mod Chat",description:"MSAY messages",selector:".mod_channel",admin:!0},{type:g,name:"Admin Log",description:"ADMIN LOG: Urist McAdmin has jumped to coordinates X, Y, Z",selector:".log_message",admin:!0},{type:p,name:"Attack Log",description:"Urist McTraitor has shot John Doe",admin:!0},{type:f,name:"Debug Log",description:"DEBUG: SSPlanets subsystem Recover().",admin:!0}];t.MESSAGE_TYPES=m},50351:function(e,t,n){"use strict";t.__esModule=!0,t.chatReducer=t.chatMiddleware=t.ChatTabs=t.ChatPanel=t.ChatPageSettings=void 0;var r=n(45104);t.ChatPageSettings=r.ChatPageSettings;var o=n(17014);t.ChatPanel=o.ChatPanel;var i=n(97724);t.ChatTabs=i.ChatTabs;var a=n(20063);t.chatMiddleware=a.chatMiddleware;var c=n(92956);t.chatReducer=c.chatReducer},20063:function(e,t,n){"use strict";t.__esModule=!0,t.chatMiddleware=void 0;var r,o=(r=n(35710))&&r.__esModule?r:{"default":r},i=n(61010),a=n(99457),c=n(31251),s=n(74275),u=n(48463),l=n(71891),d=n(82316),h=n(67063);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(){f=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=t&&t.prototype instanceof d?t:d,i=Object.create(o.prototype),a=new w(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return N()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}e.wrap=s;var l={};function d(){}function h(){}function g(){}var p={};c(p,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(A([])));v&&v!==t&&n.call(v,o)&&(p=v);var y=g.prototype=d.prototype=Object.create(p);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var s=u(e[o],e,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,c)}))}c(s.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function _(e,t){var n=e.iterator[t.method];if(undefined===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=undefined,_(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:N}}function N(){return{value:undefined,done:!0}}return h.prototype=g,c(y,"constructor",g),c(g,"constructor",h),h.displayName=c(g,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},S(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(s(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(y),c(y,a,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=undefined),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),l}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=undefined),l}},e}function m(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,o)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){m(i,r,o,a,c,"next",e)}function c(e){m(i,r,o,a,c,"throw",e)}a(undefined)}))}}var y=["a","iframe","link","video"],S=function(){var e=v(f().mark((function t(e){var n,r,o;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(0,h.selectChat)(e.getState()),r=Math.max(0,d.chatRenderer.messages.length-u.MAX_PERSISTED_MESSAGES),o=d.chatRenderer.messages.slice(r).map((function(e){return(0,l.serializeMessage)(e)})),i.storage.set("chat-state",n),i.storage.set("chat-messages",o);case 5:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=v(f().mark((function t(e){var n,r,a,c,u,h,p;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.storage.get("chat-state"),i.storage.get("chat-messages")]);case 2:if(n=t.sent,r=n[0],a=n[1],!(r&&r.version<=4)){t.next=8;break}return e.dispatch((0,s.loadChat)()),t.abrupt("return");case 8:if(a){for(c=g(a);!(u=c()).done;)(h=u.value).html&&(h.html=o["default"].sanitize(h.html,{FORBID_TAGS:y}));p=[].concat(a,[(0,l.createMessage)({type:"internal/reconnected"})]),d.chatRenderer.processBatch(p,{prepend:!0})}e.dispatch((0,s.loadChat)(r));case 10:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}();t.chatMiddleware=function(e){var t=!1,n=!1;return d.chatRenderer.events.on("batchProcessed",(function(t){n&&e.dispatch((0,s.updateMessageCount)(t))})),d.chatRenderer.events.on("scrollTrackingChanged",(function(t){e.dispatch((0,s.changeScrollTracking)(t))})),setInterval((function(){return S(e)}),u.MESSAGE_SAVE_INTERVAL),function(r){return function(o){var i=o.type,u=o.payload;if(t||(t=!0,b(e)),"chat/message"!==i){if(i===s.loadChat.type){r(o);var l=(0,h.selectCurrentChatPage)(e.getState());return d.chatRenderer.changePage(l),d.chatRenderer.onStateLoaded(),void(n=!0)}if(i!==s.changeChatPage.type&&i!==s.addChatPage.type&&i!==s.removeChatPage.type&&i!==s.toggleAcceptedType.type){if(i===s.rebuildChat.type)return d.chatRenderer.rebuildChat(),r(o);if(i!==a.updateSettings.type&&i!==a.loadSettings.type){if("roundrestart"===i)return S(e),r(o);if(i!==s.saveChatToDisk.type)return r(o);d.chatRenderer.saveToDisk()}else{r(o);var g=(0,c.selectSettings)(e.getState());d.chatRenderer.setHighlight(g.highlightText,g.highlightColor)}}else{r(o);var p=(0,h.selectCurrentChatPage)(e.getState());d.chatRenderer.changePage(p)}}else{var f=Array.isArray(u)?u:[u];d.chatRenderer.processBatch(f)}}}}},71891:function(e,t,n){"use strict";t.__esModule=!0,t.serializeMessage=t.isSameMessage=t.createPage=t.createMessage=t.createMainPage=t.canPageAcceptType=void 0;var r=n(98202),o=n(48463);function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.canPageAcceptType=function(e,t){return t.startsWith(o.MESSAGE_TYPE_INTERNAL)||e.acceptedTypes[t]};var c=function(e){return Object.assign({id:(0,r.createUuid)(),name:"New Tab",acceptedTypes:{},unreadCount:0,createdAt:Date.now()},e)};t.createPage=c;t.createMainPage=function(){for(var e,t={},n=i(o.MESSAGE_TYPES);!(e=n()).done;){t[e.value.type]=!0}return c({name:"Main",acceptedTypes:t})};t.createMessage=function(e){return Object.assign({createdAt:Date.now()},e)};t.serializeMessage=function(e){return{type:e.type,text:e.text,html:e.html,times:e.times,createdAt:e.createdAt}};t.isSameMessage=function(e,t){return"string"==typeof e.text&&e.text===t.text||"string"==typeof e.html&&e.html===t.html}},92956:function(e,t,n){"use strict";t.__esModule=!0,t.initialState=t.chatReducer=void 0;var r,o=n(74275),i=n(71891),a=["pageId"];function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=(0,i.createMainPage)(),l={version:5,currentPageId:u.id,scrollTracking:!0,pages:[u.id],pageById:(r={},r[u.id]=u,r)};t.initialState=l;t.chatReducer=function(e,t){void 0===e&&(e=l);var n,r=t.type,s=t.payload;if(r===o.loadChat.type){if((null==s?void 0:s.version)!==e.version)return e;for(var d=0,h=Object.keys(s.pageById);d<h.length;d++){var g=h[d];s.pageById[g].unreadCount=0}return Object.assign({},e,s)}if(r===o.changeScrollTracking.type){var p=s,f=Object.assign({},e,{scrollTracking:p});if(p){var m,v=e.currentPageId,y=Object.assign({},e.pageById[v],{unreadCount:0});f.pageById=Object.assign({},e.pageById,((m={})[v]=y,m))}return f}if(r===o.updateMessageCount.type){for(var S,b=s,_=e.pages.map((function(t){return e.pageById[t]})),E=e.pageById[e.currentPageId],C=Object.assign({},e.pageById),w=c(_);!(S=w()).done;){for(var A=S.value,N=0,T=0,M=Object.keys(b);T<M.length;T++){var I=M[T];(0,i.canPageAcceptType)(A,I)&&(A===E&&e.scrollTracking||A!==E&&(0,i.canPageAcceptType)(E,I)||(N+=b[I]))}N>0&&(C[A.id]=Object.assign({},A,{unreadCount:A.unreadCount+N}))}return Object.assign({},e,{pageById:C})}if(r===o.addChatPage.type)return Object.assign({},e,{currentPageId:s.id,pages:[].concat(e.pages,[s.id]),pageById:Object.assign({},e.pageById,(n={},n[s.id]=s,n))});if(r===o.changeChatPage.type){var x,P=s.pageId,k=Object.assign({},e.pageById[P],{unreadCount:0});return Object.assign({},e,{currentPageId:P,pageById:Object.assign({},e.pageById,(x={},x[P]=k,x))})}if(r===o.updateChatPage.type){var O,L=s.pageId,R=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(s,a),G=Object.assign({},e.pageById[L],R);return Object.assign({},e,{pageById:Object.assign({},e.pageById,(O={},O[L]=G,O))})}if(r===o.toggleAcceptedType.type){var V,B=s.pageId,j=s.type,D=Object.assign({},e.pageById[B]);return D.acceptedTypes=Object.assign({},D.acceptedTypes),D.acceptedTypes[j]=!D.acceptedTypes[j],Object.assign({},e,{pageById:Object.assign({},e.pageById,(V={},V[B]=D,V))})}if(r===o.removeChatPage.type){var F=s.pageId,Y=Object.assign({},e,{pages:[].concat(e.pages),pageById:Object.assign({},e.pageById)});return delete Y.pageById[F],Y.pages=Y.pages.filter((function(e){return e!==F})),0===Y.pages.length&&(Y.pages.push(u.id),Y.pageById[u.id]=u,Y.currentPageId=u.id),Y.currentPageId&&Y.currentPageId!==F||(Y.currentPageId=Y.pages[0]),Y}return e}},82316:function(e,t,n){"use strict";t.__esModule=!0,t.chatRenderer=void 0;var r=n(70088),o=n(54666),i=n(20641),a=n(48463),c=n(71891),s=n(30116);function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=(0,i.createLogger)("chatRenderer"),h=function(e,t){var n=document.createElement("span");return n.className="Chat__highlight",n.setAttribute("style","background-color:"+t),n.textContent=e,n},g=function(){var e=document.createElement("div");return e.className="ChatMessage",e},p=function(){var e=document.createElement("div");return e.className="Chat__reconnected",e},f=function(e){setTimeout((function(){var t=e.target,n=parseInt(t.getAttribute("data-reload-n"),10)||0;if(n>=a.IMAGE_RETRY_LIMIT)d.error("failed to load an image after "+n+" attempts");else{var r=t.src;t.src=null,t.src=r+"#"+n,t.setAttribute("data-reload-n",n+1)}}),a.IMAGE_RETRY_DELAY)},m=function(e){var t=e.node,n=e.times;if(t&&n){var r=t.querySelector(".Chat__badge"),i=r||document.createElement("div");i.textContent=n,i.className=(0,o.classes)(["Chat__badge","Chat__badge--animate"]),requestAnimationFrame((function(){i.className="Chat__badge"})),r||t.appendChild(i)}},v=function(){function e(){var e=this;this.loaded=!1,this.rootNode=null,this.queue=[],this.messages=[],this.visibleMessages=[],this.page=null,this.events=new r.EventEmitter,this.scrollNode=null,this.scrollTracking=!0,this.handleScroll=function(t){var n=e.scrollNode,r=n.scrollHeight,o=n.scrollTop+n.offsetHeight,i=Math.abs(r-o)<24;i!==e.scrollTracking&&(e.scrollTracking=i,e.events.emit("scrollTrackingChanged",i),d.debug("tracking",e.scrollTracking))},this.ensureScrollTracking=function(){e.scrollTracking&&e.scrollToBottom()},setInterval((function(){return e.pruneMessages()}),a.MESSAGE_PRUNE_INTERVAL)}var t=e.prototype;return t.isReady=function(){return this.loaded&&this.rootNode&&this.page},t.mount=function(e){var t=this;this.rootNode?e.appendChild(this.rootNode):this.rootNode=e,this.scrollNode=function(e){for(var t=document.body,n=e;n&&n!==t;){if(n.scrollWidth<n.offsetWidth)return n;n=n.parentNode}return window}(this.rootNode),this.scrollNode.addEventListener("scroll",this.handleScroll),setImmediate((function(){t.scrollToBottom()})),this.tryFlushQueue()},t.onStateLoaded=function(){this.loaded=!0,this.tryFlushQueue()},t.tryFlushQueue=function(){this.isReady()&&this.queue.length>0&&(this.processBatch(this.queue),this.queue=[])},t.assignStyle=function(e){void 0===e&&(e={});for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];this.rootNode.style.setProperty(r,e[r])}},t.setHighlight=function(e,t){if(!e||!t)return this.highlightRegex=null,void(this.highlightColor=null);var n=/^[a-z0-9_\-\s]+$/gi,r=String(e).split(",").map((function(e){return e.trim()})).filter((function(e){return e&&e.length>1&&n.test(e)}));if(0===r.length)return this.highlightRegex=null,void(this.highlightColor=null);this.highlightRegex=new RegExp("("+r.join("|")+")","gi"),this.highlightColor=t},t.scrollToBottom=function(){this.scrollNode.scrollTop=this.scrollNode.scrollHeight},t.changePage=function(e){if(!this.isReady())return this.page=e,void this.tryFlushQueue();this.page=e,this.rootNode.textContent="",this.visibleMessages=[];for(var t,n,r=document.createDocumentFragment(),o=u(this.messages);!(n=o()).done;){var i=n.value;(0,c.canPageAcceptType)(e,i.type)&&(t=i.node,r.appendChild(t),this.visibleMessages.push(i))}t&&(this.rootNode.appendChild(r),t.scrollIntoView())},t.getCombinableMessage=function(e){for(var t=Date.now(),n=this.visibleMessages.length,r=n-1,o=Math.max(0,n-a.COMBINE_MAX_MESSAGES),i=r;i>=o;i--){var s=this.visibleMessages[i];if(!s.type.startsWith(a.MESSAGE_TYPE_INTERNAL)&&(0,c.isSameMessage)(s,e)&&t<s.createdAt+a.COMBINE_MAX_TIME_WINDOW)return s}return null},t.processBatch=function(e,t){var n=this;void 0===t&&(t={});var r=t,o=r.prepend,i=r.notifyListeners,l=void 0===i||i,v=Date.now();if(this.isReady()){for(var y,S,b=document.createDocumentFragment(),_={},E=u(e);!(S=E()).done;){var C=S.value,w=(0,c.createMessage)(C),A=this.getCombinableMessage(w);if(A)A.times=(A.times||1)+1,m(A);else{if(w.node)y=w.node;else if("internal/reconnected"===w.type)y=p();else{y=g(),w.text?y.textContent=w.text:w.html?y.innerHTML=w.html:d.error("Error: message is missing text payload",w),!w.avoidHighlighting&&this.highlightRegex&&(0,s.highlightNode)(y,this.highlightRegex,(function(e){return h(e,n.highlightColor)}))&&(y.className+=" ChatMessage--highlighted");for(var N=y.querySelectorAll(".linkify"),T=0;T<N.length;++T)(0,s.linkifyNode)(N[T]);if(v<w.createdAt+a.IMAGE_RETRY_MESSAGE_AGE)for(var M=y.querySelectorAll("img"),I=0;I<M.length;I++)M[I].addEventListener("error",f)}if(w.node=y,!w.type){var x=!Byond.IS_LTE_IE8&&a.MESSAGE_TYPES.find((function(e){return e.selector&&y.querySelector(e.selector)}));w.type=(null==x?void 0:x.type)||a.MESSAGE_TYPE_UNKNOWN}m(w),_[w.type]||(_[w.type]=0),_[w.type]+=1,this.messages.push(w),(0,c.canPageAcceptType)(this.page,w.type)&&(b.appendChild(y),this.visibleMessages.push(w))}}if(y){var P=this.rootNode.childNodes[0];o&&P?this.rootNode.insertBefore(b,P):this.rootNode.appendChild(b),this.scrollTracking&&setImmediate((function(){return n.scrollToBottom()}))}l&&this.events.emit("batchProcessed",_)}else this.queue=o?[].concat(e,this.queue):[].concat(this.queue,e)},t.pruneMessages=function(){if(this.isReady())if(this.scrollTracking){var e=this.visibleMessages,t=Math.max(0,e.length-a.MAX_VISIBLE_MESSAGES);if(t>0){this.visibleMessages=e.slice(t);for(var n=0;n<t;n++){var r=e[n];this.rootNode.removeChild(r.node),r.node="pruned"}this.messages=this.messages.filter((function(e){return"pruned"!==e.node})),d.log("pruned "+t+" visible messages")}var o=Math.max(0,this.messages.length-a.MAX_PERSISTED_MESSAGES);o>0&&(this.messages=this.messages.slice(o),d.log("pruned "+o+" stored messages"))}else d.debug("pruning delayed")},t.rebuildChat=function(){if(this.isReady()){for(var e,t=Math.max(0,this.messages.length-a.MAX_PERSISTED_MESSAGES),n=this.messages.slice(t),r=u(n);!(e=r()).done;)e.value.node=undefined;this.rootNode.textContent="",this.messages=[],this.visibleMessages=[],this.processBatch(n,{notifyListeners:!1})}},t.saveToDisk=function(){if(!Byond.IS_LTE_IE10){for(var e="",t=document.styleSheets,n=0;n<t.length;n++)for(var r=t[n].cssRules,o=0;o<r.length;o++)e+=r[o].cssText+"\n";e+="body, html { background-color: #141414 }\n";for(var i,a="",c=u(this.visibleMessages);!(i=c()).done;){var s=i.value;s.node&&(a+=s.node.outerHTML+"\n")}var l=new Blob(["<!doctype html>\n<html>\n<head>\n<title>SS13 Chat Log</title>\n<style>\n"+e+'</style>\n</head>\n<body>\n<div class="Chat">\n'+a+"</div>\n</body>\n</html>\n"]),d=(new Date).toISOString().substring(0,19).replace(/[-:]/g,"").replace("T","-");window.navigator.msSaveBlob(l,"ss13-chatlog-"+d+".html")}},e}();window.__chatRenderer__||(window.__chatRenderer__=new v);var y=window.__chatRenderer__;t.chatRenderer=y},30116:function(e,t){"use strict";t.__esModule=!0,t.replaceInTextNode=t.linkifyNode=t.highlightNode=void 0;var n=function(e,t){return function(n){for(var r,o,i=n.textContent,a=i.length,c=0,s=0;r=e.exec(i);){s+=1,o||(o=document.createDocumentFragment());var u=r[0],l=u.length,d=r.index;c<d&&o.appendChild(document.createTextNode(i.substring(c,d))),c=d+l,o.appendChild(t(u))}return o&&(c<a&&o.appendChild(document.createTextNode(i.substring(c,a))),n.parentNode.replaceChild(o,n)),s}};t.replaceInTextNode=n;var r=function(e){var t=document.createElement("span");return t.setAttribute("style","background-color:#fd4;color:#000"),t.textContent=e,t};t.highlightNode=function i(e,t,o){void 0===o&&(o=r),o||(o=r);for(var a=0,c=e.childNodes,s=0;s<c.length;s++){var u=c[s];3===u.nodeType?a+=n(t,o)(u):a+=i(u,t,o)}return a};t.linkifyNode=function a(e){for(var t=0,n=e.childNodes,r=0;r<n.length;r++){var i=n[r],c=String(i.nodeName).toLowerCase();3===i.nodeType?t+=o(i):"a"!==c&&(t+=a(i))}return t};var o=n(/(?:(?:https?:\/\/)|(?:www\.))(?:[^ ]*?\.[^ ]*?)+[-A-Za-z0-9+&@#/%?=~_|$!:,.;()]+/gi,(function(e){var t=document.createElement("a");return t.href=e,t.textContent=e,t}))},67063:function(e,t,n){"use strict";t.__esModule=!0,t.selectCurrentChatPage=t.selectChatPages=t.selectChatPageById=t.selectChat=void 0;var r=n(95838);t.selectChat=function(e){return e.chat};t.selectChatPages=function(e){return(0,r.map)((function(t){return e.chat.pageById[t]}))(e.chat.pages)};t.selectCurrentChatPage=function(e){return e.chat.pageById[e.chat.currentPageId]};t.selectChatPageById=function(e){return function(t){return t.chat.pageById[e]}}},50879:function(e,t,n){"use strict";t.__esModule=!0,t.roundRestarted=t.connectionRestored=t.connectionLost=void 0;var r=n(42730),o=(0,r.createAction)("roundrestart");t.roundRestarted=o;var i=(0,r.createAction)("game/connectionLost");t.connectionLost=i;var a=(0,r.createAction)("game/connectionRestored");t.connectionRestored=a},95084:function(e,t){"use strict";t.__esModule=!0,t.CONNECTION_LOST_AFTER=void 0;t.CONNECTION_LOST_AFTER=15e3},38269:function(e,t,n){"use strict";t.__esModule=!0,t.useGame=void 0;var r=n(42730),o=n(51389);t.useGame=function(e){return(0,r.useSelector)(e,o.selectGame)}},63789:function(e,t,n){"use strict";t.__esModule=!0,t.useGame=t.gameReducer=t.gameMiddleware=void 0;var r=n(38269);t.useGame=r.useGame;var o=n(48389);t.gameMiddleware=o.gameMiddleware;var i=n(13794);t.gameReducer=i.gameReducer},48389:function(e,t,n){"use strict";t.__esModule=!0,t.gameMiddleware=void 0;var r=n(48674),o=n(50879),i=n(51389),a=n(95084),c=function(e){return Object.assign({},e,{meta:Object.assign({},e.meta,{now:Date.now()})})};t.gameMiddleware=function(e){var t;return setInterval((function(){var n=e.getState();if(n){var r=(0,i.selectGame)(n),s=t&&Date.now()>=t+a.CONNECTION_LOST_AFTER;!r.connectionLostAt&&s&&e.dispatch(c((0,o.connectionLost)())),r.connectionLostAt&&!s&&e.dispatch(c((0,o.connectionRestored)()))}}),1e3),function(e){return function(n){var i=n.type,a=(n.payload,n.meta);return i===r.pingSuccess.type?(t=a.now,e(n)):i===o.roundRestarted.type?e(c(n)):e(n)}}}},13794:function(e,t,n){"use strict";t.__esModule=!0,t.gameReducer=void 0;var r=n(50879),o={roundId:null,roundTime:null,roundRestartedAt:null,connectionLostAt:null};t.gameReducer=function(e,t){void 0===e&&(e=o);var n=t.type,i=(t.payload,t.meta);return"roundrestart"===n?Object.assign({},e,{roundRestartedAt:i.now}):n===r.connectionLost.type?Object.assign({},e,{connectionLostAt:i.now}):n===r.connectionRestored.type?Object.assign({},e,{connectionLostAt:null}):e}},51389:function(e,t){"use strict";t.__esModule=!0,t.selectGame=void 0;t.selectGame=function(e){return e.game}},31075:function(e,t,n){"use strict";var r=n(9333);n(44988),n(58853);var o,i,a=n(33290),c=n(42730),s=(n(47212),n(44992)),u=n(17621),l=n(40490),d=n(91731),h=n(29537),g=n(50351),p=n(63789),f=n(68042),m=n(97125),v=n(39466),y=n(14731);a.perf.mark("inception",null==(o=window.performance)||null==(i=o.timing)?void 0:i.navigationStart),a.perf.mark("init");var S=(0,d.configureStore)({reducer:(0,c.combineReducers)({audio:h.audioReducer,chat:g.chatReducer,game:p.gameReducer,ping:m.pingReducer,settings:v.settingsReducer}),middleware:{pre:[g.chatMiddleware,m.pingMiddleware,y.telemetryMiddleware,v.settingsMiddleware,h.audioMiddleware,p.gameMiddleware]}}),b=(0,l.createRenderer)((function(){var e=n(49042).Panel;return(0,r.createComponentVNode)(2,d.StoreProvider,{store:S,children:(0,r.createComponentVNode)(2,e)})}));!function _(){"loading"!==document.readyState?((0,s.setupGlobalEvents)({ignoreWindowFocus:!0}),(0,f.setupPanelFocusHacks)(),(0,u.captureExternalLinks)(),S.subscribe(b),Byond.subscribe((function(e,t){return S.dispatch({type:e,payload:t})})),Byond.winset("output",{"is-visible":!1}),Byond.winset("browseroutput",{"is-visible":!0,"is-disabled":!1,pos:"0x0",size:"0x0"}),Byond.winget("output").then((function(e){Byond.winset("browseroutput",{size:e.size})}))):document.addEventListener("DOMContentLoaded",_)}()},68042:function(e,t,n){"use strict";t.__esModule=!0,t.setupPanelFocusHacks=void 0;var r=n(69940),o=n(44992),i=n(32911),a=function(){return setImmediate((function(){return(0,i.focusMap)()}))};t.setupPanelFocusHacks=function(){var e=!1,t=null;window.addEventListener("focusin",(function(t){e=(0,o.canStealFocus)(t.target)})),window.addEventListener("mousedown",(function(e){t=[e.screenX,e.screenY]})),window.addEventListener("mouseup",(function(n){if(t){var o=[n.screenX,n.screenY];(0,r.vecLength)((0,r.vecSubtract)(o,t))>=10&&(e=!0)}e||a()})),o.globalEvents.on("keydown",(function(e){e.isModifierKey()||a()}))}},59789:function(e,t,n){"use strict";t.__esModule=!0,t.PingIndicator=void 0;var r=n(9333),o=n(1689),i=n(42991),a=n(42730),c=n(13435),s=n(66633);t.PingIndicator=function(e,t){var n=(0,a.useSelector)(t,s.selectPing),u=o.Color.lookup(n.networkQuality,[new o.Color(220,40,40),new o.Color(220,200,40),new o.Color(60,220,40)]),l=n.roundtrip?(0,i.toFixed)(n.roundtrip):"--";return(0,r.createVNode)(1,"div","Ping",[(0,r.createComponentVNode)(2,c.Box,{className:"Ping__indicator",backgroundColor:u}),l],0)}},48674:function(e,t,n){"use strict";t.__esModule=!0,t.pingSuccess=t.pingReply=t.pingFail=void 0;var r=n(42730),o=(0,r.createAction)("ping/success",(function(e){var t=Date.now(),n=.5*(t-e.sentAt);return{payload:{lastId:e.id,roundtrip:n},meta:{now:t}}}));t.pingSuccess=o;var i=(0,r.createAction)("ping/fail");t.pingFail=i;var a=(0,r.createAction)("ping/reply");t.pingReply=a},79502:function(e,t){"use strict";t.__esModule=!0,t.PING_TIMEOUT=t.PING_ROUNDTRIP_WORST=t.PING_ROUNDTRIP_BEST=t.PING_QUEUE_SIZE=t.PING_MAX_FAILS=t.PING_INTERVAL=void 0;t.PING_INTERVAL=2500;t.PING_TIMEOUT=2e3;t.PING_MAX_FAILS=3;t.PING_QUEUE_SIZE=8;t.PING_ROUNDTRIP_BEST=50;t.PING_ROUNDTRIP_WORST=200},97125:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=t.pingMiddleware=t.PingIndicator=void 0;var r=n(38947);t.pingMiddleware=r.pingMiddleware;var o=n(59789);t.PingIndicator=o.PingIndicator;var i=n(86798);t.pingReducer=i.pingReducer},38947:function(e,t,n){"use strict";t.__esModule=!0,t.pingMiddleware=void 0;var r=n(48674),o=n(79502);t.pingMiddleware=function(e){var t,n=!1,i=0,a=[],c=function(){for(var t=0;t<o.PING_QUEUE_SIZE;t++){var n=a[t];n&&Date.now()-n.sentAt>o.PING_TIMEOUT&&(a[t]=null,e.dispatch((0,r.pingFail)()))}var c={index:i,sentAt:Date.now()};a[i]=c,Byond.sendMessage("ping",{index:i}),i=(i+1)%o.PING_QUEUE_SIZE};return function(e){return function(i){var s=i.type,u=i.payload;if(n||(n=!0,t=setInterval(c,o.PING_INTERVAL),c()),"roundrestart"===s)return clearInterval(t),e(i);if("pingReply"===s){var l=u.index,d=a[l];if(!d)return;return a[l]=null,e((0,r.pingSuccess)(d))}return e(i)}}}},86798:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=void 0;var r=n(42991),o=n(48674),i=n(79502);t.pingReducer=function(e,t){void 0===e&&(e={});var n=t.type,a=t.payload;if(n===o.pingSuccess.type){var c=a.roundtrip,s=e.roundtripAvg||c,u=Math.round(.4*s+.6*c);return{roundtrip:c,roundtripAvg:u,failCount:0,networkQuality:1-(0,r.scale)(u,i.PING_ROUNDTRIP_BEST,i.PING_ROUNDTRIP_WORST)}}if(n===o.pingFail.type){var l=e.failCount,d=void 0===l?0:l,h=(0,r.clamp01)(e.networkQuality-d/i.PING_MAX_FAILS),g=Object.assign({},e,{failCount:d+1,networkQuality:h});return d>i.PING_MAX_FAILS&&(g.roundtrip=undefined,g.roundtripAvg=undefined),g}return e}},66633:function(e,t){"use strict";t.__esModule=!0,t.selectPing=void 0;t.selectPing=function(e){return e.ping}},36313:function(e,t,n){"use strict";t.__esModule=!0,t.SettingsPanel=t.SettingsGeneral=void 0;var r=n(9333),o=n(42991),i=n(57905),a=n(42730),c=n(13435),s=n(50351),u=n(74275),l=n(63671),d=n(99457),h=n(58685),g=n(31251);t.SettingsPanel=function(e,t){var n=(0,a.useSelector)(t,g.selectActiveTab),o=(0,a.useDispatch)(t);return(0,r.createComponentVNode)(2,c.Stack,{fill:!0,children:[(0,r.createComponentVNode)(2,c.Stack.Item,{children:(0,r.createComponentVNode)(2,c.Section,{fitted:!0,fill:!0,minHeight:"8em",children:(0,r.createComponentVNode)(2,c.Tabs,{vertical:!0,children:h.SETTINGS_TABS.map((function(e){return(0,r.createComponentVNode)(2,c.Tabs.Tab,{selected:e.id===n,onClick:function(){return o((0,d.changeSettingsTab)({tabId:e.id}))},children:e.name},e.id)}))})})}),(0,r.createComponentVNode)(2,c.Stack.Item,{grow:1,basis:0,children:["general"===n&&(0,r.createComponentVNode)(2,p),"chatPage"===n&&(0,r.createComponentVNode)(2,s.ChatPageSettings)]})]})};var p=function(e,t){var n=(0,a.useSelector)(t,g.selectSettings),s=n.theme,p=n.fontFamily,f=n.fontSize,m=n.lineHeight,v=n.highlightText,y=n.highlightColor,S=(0,a.useDispatch)(t),b=(0,i.useLocalState)(t,"freeFont",!1),_=b[0],E=b[1];return(0,r.createComponentVNode)(2,c.Section,{children:[(0,r.createComponentVNode)(2,c.LabeledList,{children:[(0,r.createComponentVNode)(2,c.LabeledList.Item,{label:"Theme",children:(0,r.createComponentVNode)(2,c.Dropdown,{selected:s,options:l.THEMES,onSelected:function(e){return S((0,d.updateSettings)({theme:e}))}})}),(0,r.createComponentVNode)(2,c.LabeledList.Item,{label:"Font style",children:(0,r.createComponentVNode)(2,c.Stack,{inline:!0,align:"baseline",children:[(0,r.createComponentVNode)(2,c.Stack.Item,{children:!_&&(0,r.createComponentVNode)(2,c.Dropdown,{selected:p,options:h.FONTS,onSelected:function(e){return S((0,d.updateSettings)({fontFamily:e}))}})||(0,r.createComponentVNode)(2,c.Input,{value:p,onChange:function(e,t){return S((0,d.updateSettings)({fontFamily:t}))}})}),(0,r.createComponentVNode)(2,c.Stack.Item,{children:(0,r.createComponentVNode)(2,c.Button,{content:"Custom font",icon:_?"lock-open":"lock",color:_?"good":"bad",ml:1,onClick:function(){E(!_)}})})]})}),(0,r.createComponentVNode)(2,c.LabeledList.Item,{label:"Font size",children:(0,r.createComponentVNode)(2,c.NumberInput,{width:"4em",step:1,stepPixelSize:10,minValue:8,maxValue:32,value:f,unit:"px",format:function(e){return(0,o.toFixed)(e)},onChange:function(e,t){return S((0,d.updateSettings)({fontSize:t}))}})}),(0,r.createComponentVNode)(2,c.LabeledList.Item,{label:"Line height",children:(0,r.createComponentVNode)(2,c.NumberInput,{width:"4em",step:.01,stepPixelSize:2,minValue:.8,maxValue:5,value:m,format:function(e){return(0,o.toFixed)(e,2)},onDrag:function(e,t){return S((0,d.updateSettings)({lineHeight:t}))}})})]}),(0,r.createComponentVNode)(2,c.Divider),(0,r.createComponentVNode)(2,c.Box,{children:[(0,r.createComponentVNode)(2,c.Flex,{mb:1,color:"label",align:"baseline",children:[(0,r.createComponentVNode)(2,c.Flex.Item,{grow:1,children:"Highlight words (comma separated):"}),(0,r.createComponentVNode)(2,c.Flex.Item,{shrink:0,children:[(0,r.createComponentVNode)(2,c.ColorBox,{mr:1,color:y}),(0,r.createComponentVNode)(2,c.Input,{width:"5em",monospace:!0,placeholder:"#ffffff",value:y,onInput:function(e,t){return S((0,d.updateSettings)({highlightColor:t}))}})]})]}),(0,r.createComponentVNode)(2,c.TextArea,{height:"3em",value:v,onChange:function(e,t){return S((0,d.updateSettings)({highlightText:t}))}})]}),(0,r.createComponentVNode)(2,c.Divider),(0,r.createComponentVNode)(2,c.Box,{children:[(0,r.createComponentVNode)(2,c.Button,{icon:"check",onClick:function(){return S((0,u.rebuildChat)())},children:"Apply now"}),(0,r.createComponentVNode)(2,c.Box,{inline:!0,fontSize:"0.9em",ml:1,color:"label",children:"Can freeze the chat for a while."})]}),(0,r.createComponentVNode)(2,c.Divider),(0,r.createComponentVNode)(2,c.Button,{icon:"save",onClick:function(){return S((0,u.saveChatToDisk)())},children:"Save chat log"})]})};t.SettingsGeneral=p},99457:function(e,t,n){"use strict";t.__esModule=!0,t.updateSettings=t.toggleSettings=t.openChatSettings=t.loadSettings=t.changeSettingsTab=void 0;var r=n(42730),o=(0,r.createAction)("settings/update");t.updateSettings=o;var i=(0,r.createAction)("settings/load");t.loadSettings=i;var a=(0,r.createAction)("settings/changeTab");t.changeSettingsTab=a;var c=(0,r.createAction)("settings/toggle");t.toggleSettings=c;var s=(0,r.createAction)("settings/openChatTab");t.openChatSettings=s},58685:function(e,t){"use strict";t.__esModule=!0,t.SETTINGS_TABS=t.FONTS_DISABLED=t.FONTS=void 0;t.SETTINGS_TABS=[{id:"general",name:"General"},{id:"chatPage",name:"Chat Tabs"}];var n="Default";t.FONTS_DISABLED=n;var r=[n,"Verdana","Arial","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Courier New","Lucida Console"];t.FONTS=r},65953:function(e,t,n){"use strict";t.__esModule=!0,t.useSettings=void 0;var r=n(42730),o=n(99457),i=n(31251);t.useSettings=function(e){var t=(0,r.useSelector)(e,i.selectSettings),n=(0,r.useDispatch)(e);return Object.assign({},t,{visible:t.view.visible,toggle:function(){return n((0,o.toggleSettings)())},update:function(e){return n((0,o.updateSettings)(e))}})}},39466:function(e,t,n){"use strict";t.__esModule=!0,t.useSettings=t.settingsReducer=t.settingsMiddleware=t.SettingsPanel=void 0;var r=n(65953);t.useSettings=r.useSettings;var o=n(7715);t.settingsMiddleware=o.settingsMiddleware;var i=n(85131);t.settingsReducer=i.settingsReducer;var a=n(36313);t.SettingsPanel=a.SettingsPanel},7715:function(e,t,n){"use strict";t.__esModule=!0,t.settingsMiddleware=void 0;var r=n(61010),o=n(63671),i=n(99457),a=n(31251),c=n(58685);t.settingsMiddleware=function(e){var t=!1;return function(n){return function(s){var u,l,d=s.type,h=s.payload;if(t||(t=!0,r.storage.get("panel-settings").then((function(t){e.dispatch((0,i.loadSettings)(t))}))),d===i.updateSettings.type||d===i.loadSettings.type){var g=null==h?void 0:h.theme;g&&(0,o.setClientTheme)(g),n(s);var p=(0,a.selectSettings)(e.getState());return l=p.fontSize,document.documentElement.style.setProperty("font-size",l+"px"),document.body.style.setProperty("font-size",l+"px"),(u=p.fontFamily)===c.FONTS_DISABLED&&(u=null),document.documentElement.style.setProperty("font-family",u),document.body.style.setProperty("font-family",u),void r.storage.set("panel-settings",p)}return n(s)}}}},85131:function(e,t,n){"use strict";t.__esModule=!0,t.settingsReducer=void 0;var r=n(99457),o=n(58685),i={version:1,fontSize:13,fontFamily:o.FONTS[0],lineHeight:1.2,theme:"light",adminMusicVolume:.5,highlightText:"",highlightColor:"#ffdd44",view:{visible:!1,activeTab:o.SETTINGS_TABS[0].id}};t.settingsReducer=function(e,t){void 0===e&&(e=i);var n=t.type,o=t.payload;if(n===r.updateSettings.type)return Object.assign({},e,o);if(n===r.loadSettings.type)return null!=o&&o.version?(delete o.view,Object.assign({},e,o)):e;if(n===r.toggleSettings.type)return Object.assign({},e,{view:Object.assign({},e.view,{visible:!e.view.visible})});if(n===r.openChatSettings.type)return Object.assign({},e,{view:Object.assign({},e.view,{visible:!0,activeTab:"chatPage"})});if(n===r.changeSettingsTab.type){var a=o.tabId;return Object.assign({},e,{view:Object.assign({},e.view,{activeTab:a})})}return e}},31251:function(e,t){"use strict";t.__esModule=!0,t.selectSettings=t.selectActiveTab=void 0;t.selectSettings=function(e){return e.settings};t.selectActiveTab=function(e){return e.settings.view.activeTab}},14731:function(e,t,n){"use strict";t.__esModule=!0,t.telemetryMiddleware=void 0;var r=n(61010);function o(){o=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(T){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new w(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return N()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=l(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}e.wrap=u;var d={};function h(){}function g(){}function p(){}var f={};s(f,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(A([])));v&&v!==t&&n.call(v,i)&&(f=v);var y=p.prototype=h.prototype=Object.create(f);function S(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var s=l(e[o],e,i);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,c)}))}c(s.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function _(e,t){var n=e.iterator[t.method];if(undefined===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=undefined,_(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return o.next=o}}return{next:N}}function N(){return{value:undefined,done:!0}}return g.prototype=p,s(y,"constructor",p),s(p,"constructor",g),g.displayName=s(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,c,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},S(b.prototype),s(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(y),s(y,c,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=undefined),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),d}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=undefined),d}},e}function i(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,o)}var a=(0,n(20641).createLogger)("telemetry");t.telemetryMiddleware=function(e){var t,n;return function(c){return function(s){var u,l=s.type,d=s.payload;if("telemetry/request"!==l)return"backend/update"===l?(c(s),void(u=o().mark((function p(){var i,c,s,u;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=null==d||null==(i=d.config)?void 0:i.client){o.next=4;break}return a.error("backend/update payload is missing client data!"),o.abrupt("return");case 4:if(t){o.next=13;break}return o.next=7,r.storage.get("telemetry");case 7:if(o.t0=o.sent,o.t0){o.next=10;break}o.t0={};case 10:(t=o.t0).connections||(t.connections=[]),a.debug("retrieved telemetry from storage",t);case 13:s=!1,t.connections.find((function(e){return n=c,(t=e).ckey===n.ckey&&t.address===n.address&&t.computer_id===n.computer_id;var t,n}))||(s=!0,t.connections.unshift(c),t.connections.length>10&&t.connections.pop()),s&&(a.debug("saving telemetry to storage",t),r.storage.set("telemetry",t)),n&&(u=n,n=null,e.dispatch({type:"telemetry/request",payload:u}));case 18:case"end":return o.stop()}}),p)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var o=u.apply(e,t);function a(e){i(o,n,r,a,c,"next",e)}function c(e){i(o,n,r,a,c,"throw",e)}a(undefined)}))})()):c(s);if(!t)return a.debug("deferred"),void(n=d);a.debug("sending");var h=(null==d?void 0:d.limits)||{},g=t.connections.slice(0,h.connections);Byond.sendMessage("telemetry",{connections:g})}}}},63671:function(e,t){"use strict";t.__esModule=!0,t.setClientTheme=t.THEMES=void 0;t.THEMES=["light","dark"];var n="#202020",r="#171717",o="#a4bad6",i=null;t.setClientTheme=function(e){if(clearInterval(i),Byond.command(".output statbrowser:set_theme "+e),i=setTimeout((function(){Byond.command(".output statbrowser:set_theme "+e)}),1500),"light"===e)return Byond.winset({"infowindow.background-color":"none","infowindow.text-color":"#000000","info.background-color":"none","info.text-color":"#000000","browseroutput.background-color":"none","browseroutput.text-color":"#000000","outputwindow.background-color":"none","outputwindow.text-color":"#000000","mainwindow.background-color":"none","split.background-color":"none","changelog.background-color":"none","changelog.text-color":"#000000","rules.background-color":"none","rules.text-color":"#000000","wiki.background-color":"none","wiki.text-color":"#000000","forum.background-color":"none","forum.text-color":"#000000","github.background-color":"none","github.text-color":"#000000","report-issue.background-color":"none","report-issue.text-color":"#000000","output.background-color":"none","output.text-color":"#000000","statwindow.background-color":"none","statwindow.text-color":"#000000","stat.background-color":"#FFFFFF","stat.tab-background-color":"none","stat.text-color":"#000000","stat.tab-text-color":"#000000","stat.prefix-color":"#000000","stat.suffix-color":"#000000","saybutton.background-color":"none","saybutton.text-color":"#000000","oocbutton.background-color":"none","oocbutton.text-color":"#000000","mebutton.background-color":"none","mebutton.text-color":"#000000","asset_cache_browser.background-color":"none","asset_cache_browser.text-color":"#000000","tooltip.background-color":"none","tooltip.text-color":"#000000"});"dark"===e&&Byond.winset({"infowindow.background-color":n,"infowindow.text-color":o,"info.background-color":n,"info.text-color":o,"browseroutput.background-color":n,"browseroutput.text-color":o,"outputwindow.background-color":n,"outputwindow.text-color":o,"mainwindow.background-color":n,"split.background-color":n,"changelog.background-color":"#494949","changelog.text-color":o,"rules.background-color":"#494949","rules.text-color":o,"wiki.background-color":"#494949","wiki.text-color":o,"forum.background-color":"#494949","forum.text-color":o,"github.background-color":"#3a3a3a","github.text-color":o,"report-issue.background-color":"#492020","report-issue.text-color":o,"output.background-color":r,"output.text-color":o,"statwindow.background-color":r,"statwindow.text-color":o,"stat.background-color":r,"stat.tab-background-color":n,"stat.text-color":o,"stat.tab-text-color":o,"stat.prefix-color":o,"stat.suffix-color":o,"saybutton.background-color":n,"saybutton.text-color":o,"oocbutton.background-color":n,"oocbutton.text-color":o,"mebutton.background-color":n,"mebutton.text-color":o,"asset_cache_browser.background-color":n,"asset_cache_browser.text-color":o,"tooltip.background-color":n,"tooltip.text-color":o})}},44988:function(){},58853:function(){}},n={};function r(e){var o=n[e];if(o!==undefined)return o.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,e=[],r.O=function(t,n,o,i){if(!n){var a=Infinity;for(l=0;l<e.length;l++){n=e[l][0],o=e[l][1],i=e[l][2];for(var c=!0,s=0;s<n.length;s++)(!1&i||a>=i)&&Object.keys(r.O).every((function(e){return r.O[e](n[s])}))?n.splice(s--,1):(c=!1,i<a&&(a=i));if(c){e.splice(l--,1);var u=o();u!==undefined&&(t=u)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[n,o,i]},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={3:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,a=n[0],c=n[1],s=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(s)var l=s(r)}for(t&&t(n);u<a.length;u++)i=a[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(l)},n=self.webpackChunktgui_workspace=self.webpackChunktgui_workspace||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),r.O(undefined,[962],(function(){return r(7832)}));var o=r.O(undefined,[962],(function(){return r(31075)}));o=r.O(o)}();